<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High-Power PDF Compressor - Vintellix Tools</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet"/>
    
    <!-- ‚úÖ PRIMARY LIBRARY: Ghostscript WASM (High Compression) -->
    <script src="https://unpkg.com/ghostscript-wasm@1.0.12/dist/ghostscript-wasm.umd.js"></script>
    
    <!-- ‚úÖ FALLBACK LIBRARY: PDF-lib (Reliable but Basic Compression) -->
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    
    <!-- ‚úÖ AAPKA SOCIAL BAR AD CODE -->
    <script type='text/javascript' src='//pl27286140.profitableratecpm.com/45/8a/80/458a80df8b95f358a78b8b9fdf1bc0a8.js'></script>
    
    <style>
        :root {
            --bg-dark-primary: #0A0A23;
            --bg-dark-secondary: #1A1A3A;
            --accent-primary: #00FF9F;
            --accent-secondary: #00BFFF;
            --text-dark: #EAEAEA;
            --card-bg-dark: rgba(26, 26, 58, .8);
            --card-border-dark: rgba(0, 255, 159, .4);
        }
        body {
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark-primary) 0%, var(--bg-dark-secondary) 100%);
            color: var(--text-dark);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .tool-card {
            background: var(--card-bg-dark);
            border: 2px solid var(--card-border-dark);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            backdrop-filter: blur(10px);
            text-align: center;
            box-shadow: 0 0 40px rgba(0, 255, 159, 0.3);
        }
        h3 {
            color: var(--accent-primary);
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-shadow: 0 0 10px var(--accent-primary);
        }
        p { color: var(--accent-secondary); margin-bottom: 25px; }
        input[type="file"], select {
            width: 100%; padding: 12px; margin: 15px 0; border-radius: 10px; font-family: inherit; font-size: 1rem;
            border: 1px solid var(--card-border-dark); background: rgba(0,0,0,.3); color: var(--text-dark);
        }
        select { text-align: center; }
        .process-btn {
            width: 100% !important; padding: 15px !important; margin: 15px 0 !important; border-radius: 10px !important;
            font-family: inherit !important; font-size: 1.2rem !important; border: none !important;
            background: linear-gradient(45deg, var(--accent-primary), var(--accent-secondary)) !important;
            color: #000 !important; font-weight: bold !important; cursor: pointer !important;
            box-shadow: 0 4px 15px rgba(0, 255, 159, .3) !important; transition: all 0.3s ease;
        }
        .process-btn:hover:not(:disabled) { transform: translateY(-3px) scale(1.02); }
        .process-btn:disabled { background: #555 !important; color: #999 !important; cursor: not-allowed; opacity: 0.6; }
        .loader-container { display: none; margin-top: 20px; }
        .loader { margin: 10px auto; border: 3px solid rgba(0, 255, 159, .3); border-radius: 50%; border-top: 3px solid var(--accent-primary); width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .result-info { margin-top: 20px; padding: 15px; background: rgba(0,255,159,.1); border-radius: 8px; border: 1px solid var(--accent-primary); text-align: left; }
        .download-link { display: inline-block; background: var(--accent-primary); color: #000; font-weight: bold; text-decoration: none; padding: 10px 20px; border-radius: 6px; margin-top: 15px; transition: .3s; }
        .download-link:hover { transform: scale(1.05); }
        .quality-estimate { font-size: 0.8rem; color: var(--accent-primary); opacity: 0.9; margin-left: 10px; }
        .ad-container { margin-top: 30px; border-top: 2px solid var(--card-border-dark); padding-top: 20px; }
        .error-message { color: #ff4444; background: rgba(255, 68, 68, 0.1); padding: 15px; border-radius: 8px; margin-top: 15px; }
    </style>
</head>
<body>

    <div class="tool-card">
        <h3>üöÄ High-Power Compressor</h3>
        <p id="main-status">This tool recompresses PDF images to achieve high compression.</p>
        <input type="file" id="fileInput" accept=".pdf">
        <label for="pdfSetting" style="color: var(--accent-secondary); font-size: 1rem;">Select Compression Quality:</label>
        <select id="pdfSetting">
            <option value="/screen">Low Quality (Max Compression) <span class="quality-estimate" id="lowEstimate"></span></option>
            <option value="/ebook" selected>Good Quality (Balanced) <span class="quality-estimate" id="mediumEstimate"></span></option>
            <option value="/printer">High Quality (Best for Print) <span class="quality-estimate" id="highEstimate"></span></option>
        </select>
        <button id="compressBtn" class="process-btn" disabled>Initializing Engine...</button>
        <div id="loader" class="loader-container">
            <div class="loader"></div>
            <p id="status">Starting process...</p>
        </div>
        <div id="result" style="display:none;"></div>
        <div class="ad-container">
            <script async="async" data-cfasync="false" src="//pl27286151.profitableratecpm.com/825e99b067125e141e8fa7f4353d27b4/invoke.js"></script>
            <div id="container-825e99b067125e141e8fa7f4353d27b4"></div>
        </div>
    </div>

    <script>
        // ‚úÖ DUAL ENGINE SOLUTION - Ghostscript (Primary) + PDF-lib (Fallback)
        document.addEventListener('DOMContentLoaded', () => {
            const fileInput = document.getElementById('fileInput');
            const compressBtn = document.getElementById('compressBtn');
            const loader = document.getElementById('loader');
            const status = document.getElementById('status');
            const mainStatus = document.getElementById('main-status');
            const resultDiv = document.getElementById('result');
            const lowEstimateSpan = document.getElementById('lowEstimate');
            const mediumEstimateSpan = document.getElementById('mediumEstimate');
            const highEstimateSpan = document.getElementById('highEstimate');

            let ghostscriptInstance = null;
            let useGhostscript = false;

            // ‚úÖ INITIALIZATION WITH DUAL ENGINE CHECK
            (function initializeTool() {
                let attempts = 0;
                const maxAttempts = 300; // 30 seconds timeout for Ghostscript

                const checkGS = setInterval(() => {
                    attempts++;
                    
                    try {
                        // Check for Ghostscript
                        const GS = window.Ghostscript || window.ghostscript || window.GhostscriptWasm;
                        
                        if (GS && (GS.create || GS.init)) {
                            compressBtn.disabled = false;
                            compressBtn.innerHTML = 'üóúÔ∏è Compress PDF (High Power)';
                            mainStatus.textContent = 'High-Power Engine Ready. Select a PDF file.';
                            ghostscriptInstance = GS;
                            useGhostscript = true;
                            clearInterval(checkGS);
                            return;
                        }
                    } catch (e) {
                        console.log('Checking for Ghostscript...', attempts);
                    }
                    
                    // Update status every 10 attempts
                    if (attempts % 10 === 0) {
                        mainStatus.textContent = `Loading High-Power Engine... (${Math.round(attempts/3)}s)`;
                    }
                    
                    // If Ghostscript takes too long, fallback to PDF-lib
                    if (attempts > maxAttempts) {
                        clearInterval(checkGS);
                        if (typeof PDFLib !== 'undefined') {
                            compressBtn.disabled = false;
                            compressBtn.innerHTML = 'üóúÔ∏è Compress PDF (Basic)';
                            mainStatus.textContent = 'Basic Engine Ready. Select a PDF file. (High-Power failed to load)';
                            useGhostscript = false;
                        } else {
                            compressBtn.disabled = false;
                            compressBtn.innerHTML = 'üîÑ Retry Loading';
                            mainStatus.innerHTML = `
                                <div class="error-message">
                                    ‚ö†Ô∏è Failed to load any compression engine. This might be due to:<br>
                                    ‚Ä¢ Slow internet connection<br>
                                    ‚Ä¢ Browser security settings<br>
                                    ‚Ä¢ Ad blockers blocking the library<br><br>
                                    Try refreshing the page or disabling ad blockers.
                                </div>
                            `;
                            compressBtn.onclick = () => location.reload();
                        }
                    }
                }, 100);
            })();
            
            function formatSize(kb) {
                if (kb < 1024) { return `${Math.round(kb)} KB`; }
                else { return `${(kb / 1024).toFixed(1)} MB`; }
            }
            
            function updateQualityEstimates() {
                const file = fileInput.files[0];
                if (!file) {
                    lowEstimateSpan.textContent = ''; mediumEstimateSpan.textContent = ''; highEstimateSpan.textContent = '';
                    return;
                }
                const sizeKB = file.size / 1024;
                const ranges = { low: { min: 0.70, max: 0.95 }, medium: { min: 0.40, max: 0.70 }, high: { min: 0.10, max: 0.40 } };
                const lowMinResult = sizeKB * (1 - ranges.low.max); const lowMaxResult = sizeKB * (1 - ranges.low.min);
                lowEstimateSpan.textContent = `(est. ${formatSize(lowMinResult)} - ${formatSize(lowMaxResult)})`;
                const mediumMinResult = sizeKB * (1 - ranges.medium.max); const mediumMaxResult = sizeKB * (1 - ranges.medium.min);
                mediumEstimateSpan.textContent = `(est. ${formatSize(mediumMinResult)} - ${formatSize(mediumMaxResult)})`;
                const highMinResult = sizeKB * (1 - ranges.high.max); const highMaxResult = sizeKB * (1 - ranges.high.min);
                highEstimateSpan.textContent = `(est. ${formatSize(highMinResult)} - ${formatSize(highMaxResult)})`;
            }
            
            fileInput.addEventListener('change', updateQualityEstimates);

            compressBtn.addEventListener('click', async () => {
                const file = fileInput.files[0];
                if (!file) { alert('Please select a PDF file first.'); return; }

                compressBtn.disabled = true;
                compressBtn.innerHTML = 'Processing...';
                loader.style.display = 'block';
                resultDiv.style.display = 'none';
                status.textContent = 'Reading your file...';

                try {
                    const originalSizeBytes = file.size;
                    const fileBuffer = await file.arrayBuffer();
                    
                    if (useGhostscript && ghostscriptInstance) {
                        // ‚úÖ GHOSTSCRIPT COMPRESSION (HIGH POWER)
                        status.textContent = 'Starting powerful Ghostscript engine...';
                        
                        let gs;
                        if (ghostscriptInstance.create) {
                            gs = await ghostscriptInstance.create();
                        } else if (ghostscriptInstance.init) {
                            gs = await ghostscriptInstance.init();
                        } else {
                            throw new Error('Ghostscript initialization method not found');
                        }
                        
                        status.textContent = `Compressing PDF with High-Power Engine...`;
                        
                        const pdfSetting = document.getElementById('pdfSetting').value;
                        const inputFileName = file.name.replace(/[^a-zA-Z0-9.-]/g, '_');
                        
                        const { outputFiles } = await gs.run({
                            inputFiles: [{ name: inputFileName, data: new Uint8Array(fileBuffer) }],
                            commands: [
                                `-sDEVICE=pdfwrite`,
                                `-dPDFSETTINGS=${pdfSetting}`,
                                `-dCompatibilityLevel=1.4`,
                                `-dNOPAUSE`,
                                `-dBATCH`,
                                `-dSAFER`,
                                `-o`, `compressed_${inputFileName}`,
                                inputFileName
                            ]
                        });
                        
                        await gs.destroy();
                        status.textContent = 'Finishing up...';

                        if (!outputFiles || outputFiles.length === 0) {
                            throw new Error('No output file generated by Ghostscript');
                        }

                        const compressedBytes = outputFiles[0].data;
                        const finalSizeBytes = compressedBytes.byteLength;
                        const reduction = ((originalSizeBytes - finalSizeBytes) / originalSizeBytes * 100).toFixed(1);

                        resultDiv.style.display = 'block';
                        resultDiv.innerHTML = `
                            <div class="result-info">
                                <h4>‚úÖ Compression Complete! (High-Power)</h4>
                                <p><strong>Original Size:</strong> ${(originalSizeBytes / 1024 / 1024).toFixed(2)} MB</p>
                                <p><strong>Compressed Size:</strong> ${(finalSizeBytes / 1024 / 1024).toFixed(2)} MB</p>
                                <p style="color: var(--accent-primary);"><strong>Size Reduction: ${reduction}%</strong></p>
                            </div>
                            <a href="${URL.createObjectURL(new Blob([compressedBytes], { type: 'application/pdf' }))}" download="compressed-${file.name}" class="download-link">Download Compressed PDF</a>
                        `;
                    } else if (typeof PDFLib !== 'undefined') {
                        // ‚úÖ PDF-LIB COMPRESSION (FALLBACK)
                        status.textContent = 'Starting Basic Compression Engine...';
                        const pdfDoc = await PDFLib.PDFDocument.load(fileBuffer);
                        
                        status.textContent = 'Compressing PDF with Basic Engine...';
                        const compressedPdf = await PDFLib.PDFDocument.create();
                        const pages = pdfDoc.getPages();
                        
                        for (let i = 0; i < pages.length; i++) {
                            status.textContent = `Processing page ${i + 1} of ${pages.length}...`;
                            const [copiedPage] = await compressedPdf.copyPages(pdfDoc, [i]);
                            compressedPdf.addPage(copiedPage);
                        }

                        status.textContent = 'Finalizing compressed PDF...';
                        const compressedBytes = await compressedPdf.save({
                            useObjectStreams: false,
                            addDefaultPage: false,
                            objectsPerTick: 20
                        });

                        const finalSizeBytes = compressedBytes.byteLength;
                        const reduction = originalSizeBytes > finalSizeBytes ? 
                            ((originalSizeBytes - finalSizeBytes) / originalSizeBytes * 100).toFixed(1) : 0;

                        resultDiv.style.display = 'block';
                        resultDiv.innerHTML = `
                            <div class="result-info">
                                <h4>‚úÖ Compression Complete! (Basic Mode)</h4>
                                <p><strong>Original Size:</strong> ${(originalSizeBytes / 1024 / 1024).toFixed(2)} MB</p>
                                <p><strong>Compressed Size:</strong> ${(finalSizeBytes / 1024 / 1024).toFixed(2)} MB</p>
                                <p style="color: var(--accent-primary);"><strong>Size Reduction: ${reduction}%</strong></p>
                                ${reduction == 0 ? '<p><em>Note: This PDF was already optimized or doesn\'t contain compressible content.</em></p>' : ''}
                                <p><em>Note: High-Power Engine failed to load, using Basic Engine. Results may vary.</em></p>
                            </div>
                            <a href="${URL.createObjectURL(new Blob([compressedBytes], { type: 'application/pdf' }))}" download="compressed-${file.name}" class="download-link">Download Compressed PDF</a>
                        `;
                    } else {
                        throw new Error('No compression engine available. Please refresh the page.');
                    }
                } catch (err) {
                    console.error("Compression failed:", err);
                    resultDiv.style.display = 'block';
                    resultDiv.innerHTML = `
                        <div class="error-message">
                            <h4>‚ùå Compression Failed</h4>
                            <p><strong>Error:</strong> ${err.message || 'Unknown error occurred'}</p>
                            <p>This might happen if:</p>
                            <ul style="text-align: left; margin: 10px 0;">
                                <li>The PDF is password-protected</li>
                                <li>The PDF is corrupted</li>
                                <li>The PDF has complex security features</li>
                                <li>The file is too large or complex</li>
                            </ul>
                            <p>Try with a different PDF file or refresh the page.</p>
                        </div>
                    `;
                } finally {
                    loader.style.display = 'none';
                    compressBtn.disabled = false;
                    compressBtn.innerHTML = useGhostscript ? 'üóúÔ∏è Compress PDF (High Power)' : 'üóúÔ∏è Compress PDF (Basic)';
                }
            });
        });
    </script>

</body>
</html>
